!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["ScratchCard.default"]=e():t["ScratchCard.default"]=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),o=n(2),s=n(3),a=function(){function t(t,e){var n=this,a=this,c={scratchType:i.SCRATCH_TYPE.SPRAY,container:HTMLElement,nPoints:100,pointSize:[10,10],callback:function(){alert("done.")},brushSrc:"",imageForwardSrc:"./images/scratchcard.png",imageBackgroundSrc:"./images/scratchcard-background.svg",clearZoneRadius:0};this.config=Object.assign(c,e),this.scratchType=this.config.scratchType,this.container=document.querySelector(t),this.position=[0,0],this.readyToClear=!1,this.percent=0,this.generateCanvas(),this.ctx=this.canvas.getContext("2d"),this.zone=this.canvas.getBoundingClientRect(),this.brush=new s.default(this.ctx,this.position[0],this.position[1]),this.config.scratchType===i.SCRATCH_TYPE.BRUSH&&(this.brushImage=s.default.generateBrush(this.config.brushSrc));var r=o.throttle(function(t){a.dispatchEvent("scratch","move"),a.position=a.mousePosition(t),a.brush.updateMousePosition(a.position[0],a.position[1]),a.scratch(),a.percent=a.updatePercent(),a.percent>=50&&(a.clear(),a.canvas.style.pointerEvents="none",void 0!==a.config.callback&&a.config.callback())},16);this.canvas.addEventListener("mousedown",function(t){a.canvas.addEventListener("mousemove",r),document.body.addEventListener("mouseup",function t(){a.canvas.removeEventListener("mousemove",r),this.removeEventListener("mouseup",t)})}),window.addEventListener("resize",o.throttle(function(){n.zone=n.canvas.getBoundingClientRect()},100))}return t.prototype.getPercent=function(){return this.percent},t.prototype.dispatchEvent=function(t,e){o.dispatchCustomEvent(this.canvas,t+"."+e,{})},t.prototype.init=function(){var t=this;return new Promise(function(e,n){o.loadImage(t.config.imageForwardSrc).then(function(n){t.ctx.drawImage(n,0,0,t.canvas.width,t.canvas.height),t.setBackground(),e()},function(e){return n(e),new TypeError(t.config.imageForwardSrc+" is not loaded.")})})},t.prototype.generateCanvas=function(){this.canvas=document.createElement("canvas"),this.canvas.classList.add("sc__canvas"),this.container.appendChild(this.canvas),this.canvas.width=this.container.clientWidth,this.canvas.height=this.container.clientHeight},t.prototype.setBackground=function(){var t=this,e=document.createElement("img");o.loadImage(this.config.imageBackgroundSrc).then(function(n){e.src=n.src,t.container.insertBefore(e,t.canvas)},function(t){console.log(t.message)})},t.prototype.mousePosition=function(t){var e,n;switch(t.type){case"touchmove":e=t.touches[0].clientX-this.config.clearZoneRadius/2-window.pageXOffset-this.zone.left,n=t.touches[0].clientY-this.config.clearZoneRadius/2-window.pageYOffset-this.zone.top;break;case"mousemove":e=t.clientX-this.config.clearZoneRadius-window.pageXOffset-this.zone.left,n=t.clientY-this.config.clearZoneRadius-window.pageYOffset-this.zone.top}return[e,n]},t.prototype.scratch=function(){this.position[0],this.position[1];switch(this.ctx.globalCompositeOperation="destination-out",this.ctx.save(),this.config.scratchType){case i.SCRATCH_TYPE.BRUSH:this.brush.brush(this.brushImage);break;case i.SCRATCH_TYPE.CIRCLE:this.brush.circle(this.config.clearZoneRadius);break;case i.SCRATCH_TYPE.SPRAY:this.brush.spray(this.config.clearZoneRadius,this.config.pointSize,this.config.nPoints)}this.ctx.restore()},t.prototype.updatePercent=function(){for(var t=0,e=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),n=e.data.length,i=0;i<n;i+=4)0===e.data[i]&&0===e.data[i+1]&&0===e.data[i+2]&&0===e.data[i+3]&&t++;return t>=1?t/(this.canvas.width*this.canvas.height)*100:0},t.prototype.clear=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},t}();window.ScratchCard=a,window.SCRATCH_TYPE=i.SCRATCH_TYPE,e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});!function(t){t[t.BRUSH=0]="BRUSH",t[t.SPRAY=1]="SPRAY",t[t.CIRCLE=2]="CIRCLE"}(e.SCRATCH_TYPE||(e.SCRATCH_TYPE={}))},function(t,e,n){"use strict";function i(t,e){var n=Math.abs(Math.random()*(e-t)+t);return parseInt(n.toFixed(0),10)}function o(t){return new Promise(function(e,n){var i=new Image;i.onload=function(){e(i)},i.src=t,i.onerror=function(e){var i=new Error("Image "+t+" is not loaded.");n(i)}})}function s(t,e){var n,i;return function(){var o=this,s=+new Date,a=arguments;n&&s<n+e?(clearTimeout(i),i=setTimeout(function(){n=s,t.apply(o,a)},e)):(n=s,t.apply(o,a))}}function a(t,e,n){var i=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n});t.dispatchEvent(i)}Object.defineProperty(e,"__esModule",{value:!0}),e.randomPoint=i,e.loadImage=o,e.throttle=s,function(){function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n}if("function"==typeof window.CustomEvent)return!1;t.prototype=window.Event.prototype,window.CustomEvent=t}(),e.dispatchCustomEvent=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e,n){this.ctx=t,this.mouseX=e,this.mouseY=n}return t.prototype.updateMousePosition=function(t,e){this.mouseX=t,this.mouseY=e},t.prototype.circle=function(t){this.ctx.beginPath(),this.ctx.arc(this.mouseX+t,this.mouseY+t,t,0,2*Math.PI,!1),this.ctx.fillStyle="#000000",this.ctx.fill(),this.ctx.closePath()},t.prototype.clearPoint=function(t){var e=t,n=2*Math.random()*e-e,i=Math.sqrt(e*e-n*n),o=2*Math.random()*i-i;return n+=e,o+=e,n+=this.mouseX,o+=this.mouseY,[n,o]},t.prototype.spray=function(t,e,n){var i=0,o=n;for(i;i<o;i++){var s=this.clearPoint(t/2);this.ctx.beginPath(),this.ctx.arc(s[0]+t/2,s[1]+t/2,e/2,0,2*Math.PI,!1),this.ctx.fillStyle="#000000",this.ctx.fill(),this.ctx.closePath()}},t.generateBrush=function(t){if(0!==t.length){var e=new Image;return e.src=t,e}return null},t.prototype.brush=function(t){if(null===t){var e=new Error("argument img is not a node IMG");return void console.log(e.message)}var n=Math.atan2(this.mouseY,this.mouseX);this.ctx.save(),this.ctx.translate(this.mouseX,this.mouseY),this.ctx.rotate(n),this.ctx.drawImage(t,-t.width/2,-t.height/2)},t}();e.default=i}])});