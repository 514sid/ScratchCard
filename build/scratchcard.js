!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var i in n)("object"==typeof exports?exports:t)[i]=n[i]}}(window,function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var o=function(){function t(e,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.mouseX=n,this.mouseY=i}return i(t,[{key:"updateMousePosition",value:function(t,e){this.mouseX=t,this.mouseY=e}},{key:"circle",value:function(t){this.ctx.beginPath(),this.ctx.arc(this.mouseX+t,this.mouseY+t,t,0,2*Math.PI,!1),this.ctx.fillStyle="#000000",this.ctx.fill(),this.ctx.closePath()}},{key:"clearPoint",value:function(t){var e=t,n=2*Math.random()*e-e,i=Math.sqrt(e*e-n*n),o=2*Math.random()*i-i;return n+=e,o+=e,[n+=this.mouseX,o+=this.mouseY]}},{key:"spray",value:function(t,e,n){for(var i=0,o=n;i<o;i++){var a=this.clearPoint(t/2);this.ctx.beginPath(),this.ctx.arc(a[0]+t/2,a[1]+t/2,e/2,0,2*Math.PI,!1),this.ctx.fillStyle="#000000",this.ctx.fill(),this.ctx.closePath()}}},{key:"brush",value:function(t){if(null!==t){var e=Math.atan2(this.mouseY,this.mouseX);this.ctx.save(),this.ctx.translate(this.mouseX,this.mouseY),this.ctx.rotate(e),this.ctx.drawImage(t,-t.width/2,-t.height/2)}else{var n=new Error("argument img is not a node IMG");console.log(n.message)}}}],[{key:"generateBrush",value:function(t){if(0!==t.length){var e=new Image;return e.src=t,e}return null}}]),t}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.randomPoint=function(t,e){var n=Math.abs(Math.random()*(e-t)+t);return parseInt(n.toFixed(0),10)},e.loadImage=function(t){return new Promise(function(e,n){var i=new Image;i.crossOrigin="Anonymous",i.onload=function(){e(i)},i.src=t,i.onerror=function(e){var i=new Error("Image "+t+" is not loaded.");n(i)}})},e.throttle=function(t,e){var n=void 0,i=void 0;return function(){var o=this,a=+new Date,r=arguments;n&&a<n+e?(clearTimeout(i),i=setTimeout(function(){n=a,t.apply(o,r)},e)):(n=a,t.apply(o,r))}},e.dispatchCustomEvent=function(t,e,n){var i=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n});t.dispatchEvent(i)},e.injectHTML=function(t,e){var n=new DOMParser,i=document.createElement("div");i.classList.add("sc__inner");var o=n.parseFromString(t,"text/xml");i.innerHTML=o.body.innerHTML,e.insertBefore(i,e.firstElementChild)},function(){if("function"==typeof window.CustomEvent)return!1;function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n}t.prototype=window.Event.prototype,window.CustomEvent=t}()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=e.SCRATCH_TYPE=void 0;!function(t){t[t.BRUSH=0]="BRUSH",t[t.SPRAY=1]="SPRAY",t[t.CIRCLE=2]="CIRCLE"}(i||(e.SCRATCH_TYPE=i={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ScratchCard=void 0;var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=n(2),a=n(1),r=function(t){return t&&t.__esModule?t:{default:t}}(n(0));var s=e.ScratchCard=function(){function t(e,n){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var s=this,c={scratchType:o.SCRATCH_TYPE.SPRAY,containerWidth:100,containerHeight:100,percentToFinish:50,nPoints:100,pointSize:[10,10],callback:function(){alert("done.")},brushSrc:"",imageForwardSrc:"./images/scratchcard.png",imageBackgroundSrc:"./images/scratchcard-background.svg",htmlBackground:"",clearZoneRadius:0,enabledPercentUpdate:!0};this.config=Object.assign(c,n),this.scratchType=this.config.scratchType,this.container=document.querySelector(e),this.position=[0,0],this.readyToClear=!1,this.percent=0,this.callbackDone=!1,this.generateCanvas(),this.ctx=this.canvas.getContext("2d"),this.zone=this.canvas.getBoundingClientRect(),this.brush=new r.default(this.ctx,this.position[0],this.position[1]),this.config.scratchType===o.SCRATCH_TYPE.BRUSH&&(this.brushImage=r.default.generateBrush(this.config.brushSrc));var u=(0,a.throttle)(function(t){t.preventDefault(),s.dispatchEvent("scratch","move"),s.position=s.mousePosition(t),s.brush.updateMousePosition(s.position[0],s.position[1]),s.scratch(),i.config.enabledPercentUpdate&&(s.percent=s.updatePercent())},16);this.canvas.addEventListener("mousedown",function(t){s.zone=s.canvas.getBoundingClientRect(),s.canvas.addEventListener("mousemove",u),document.body.addEventListener("mouseup",function t(){s.canvas.removeEventListener("mousemove",u),s.finish(),this.removeEventListener("mouseup",t)})}),this.canvas.addEventListener("touchstart",function(t){t.preventDefault(),s.canvas.addEventListener("touchmove",u),document.body.addEventListener("touchend",function t(){s.canvas.removeEventListener("touchmove",u),s.finish(),this.removeEventListener("touchend",t)})}),window.addEventListener("resize",(0,a.throttle)(function(){i.zone=i.canvas.getBoundingClientRect(),i.redraw()},100)),window.addEventListener("scroll",(0,a.throttle)(function(){i.zone=i.canvas.getBoundingClientRect()},16))}return i(t,[{key:"getPercent",value:function(){return this.percent}},{key:"finish",value:function(){!this.callbackDone&&this.percent>this.config.percentToFinish&&(this.clear(),this.canvas.style.pointerEvents="none",void 0!==this.config.callback&&(this.callbackDone=!0,this.config.callback()))}},{key:"dispatchEvent",value:function(t,e){(0,a.dispatchCustomEvent)(this.canvas,t+"."+e,{})}},{key:"init",value:function(){var t=this;return new Promise(function(e,n){(0,a.loadImage)(t.config.imageForwardSrc).then(function(n){t.scratchImage=n,t.ctx.drawImage(t.scratchImage,0,0,t.canvas.width,t.canvas.height),t.setBackground(),e()},function(e){return n(e),new TypeError(t.config.imageForwardSrc+" is not loaded.")})})}},{key:"generateCanvas",value:function(){this.canvas=document.createElement("canvas"),this.canvas.classList.add("sc__canvas"),this.canvas.width=this.config.containerWidth,this.canvas.height=this.config.containerHeight,this.container.appendChild(this.canvas)}},{key:"setBackground",value:function(){var t=this;if(0!==this.config.htmlBackground.length)(0,a.injectHTML)(this.config.htmlBackground,this.container);else{var e=document.createElement("img");(0,a.loadImage)(this.config.imageBackgroundSrc).then(function(n){e.src=n.src,t.container.insertBefore(e,t.canvas)},function(t){console.log(t.message)})}}},{key:"mousePosition",value:function(t){var e=void 0,n=void 0;switch(t.type){case"touchmove":e=t.touches[0].clientX-this.config.clearZoneRadius-this.zone.left,n=t.touches[0].clientY-this.config.clearZoneRadius-this.zone.top;break;case"mousemove":e=t.clientX-this.config.clearZoneRadius-this.zone.left,n=t.clientY-this.config.clearZoneRadius-this.zone.top}return[e,n]}},{key:"scratch",value:function(){this.position[0],this.position[1];switch(this.ctx.globalCompositeOperation="destination-out",this.ctx.save(),this.config.scratchType){case o.SCRATCH_TYPE.BRUSH:this.brush.brush(this.brushImage);break;case o.SCRATCH_TYPE.CIRCLE:this.brush.circle(this.config.clearZoneRadius);break;case o.SCRATCH_TYPE.SPRAY:this.brush.spray(this.config.clearZoneRadius,this.config.pointSize,this.config.nPoints)}this.ctx.restore()}},{key:"updatePercent",value:function(){for(var t=0,e=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),n=e.data.length,i=0;i<n;i+=4)0===e.data[i]&&0===e.data[i+1]&&0===e.data[i+2]&&0===e.data[i+3]&&t++;return t>=1?t/(this.canvas.width*this.canvas.height)*100:0}},{key:"redraw",value:function(){var t=this.config.containerWidth;this.zone.width<t&&(this.ctx.clearRect(0,0,this.zone.width,this.zone.height),this.canvas.width=this.zone.width,this.canvas.height=this.zone.height,this.ctx.drawImage(this.scratchImage,0,0,this.zone.width,this.zone.height))}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}]),t}();window.ScratchCard=s,window.SCRATCH_TYPE=o.SCRATCH_TYPE,e.default={ScratchCard:s,SCRATCH_TYPE:o.SCRATCH_TYPE}}])});